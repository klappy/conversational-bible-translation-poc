
import {createRequire as ___nfyCreateRequire} from "module";
import {fileURLToPath as ___nfyFileURLToPath} from "url";
import {dirname as ___nfyPathDirname} from "path";
let __filename=___nfyFileURLToPath(import.meta.url);
let __dirname=___nfyPathDirname(___nfyFileURLToPath(import.meta.url));
let require=___nfyCreateRequire(import.meta.url);


// netlify/functions/canvas-state.js
import { promises as fs } from "fs";
import { join } from "path";
var STATE_FILE = join("/tmp", "canvas-state.json");
var DEFAULT_STATE = {
  styleGuide: {
    conversationLanguage: "English",
    // Language of Wider Communication
    sourceLanguage: "English",
    // Translating from
    targetLanguage: "English",
    // Translating into
    languagePair: "English \u2192 English",
    // Legacy, kept for compatibility
    readingLevel: "Grade 1",
    tone: "Narrator, engaging tone",
    philosophy: "Meaning-based"
  },
  glossary: {
    terms: {}
  },
  scriptureCanvas: {
    verses: {}
  },
  feedback: {
    comments: []
  },
  workflow: {
    currentPhase: "planning",
    currentVerse: "Ruth 1:1",
    currentPhrase: 0,
    phrasesCompleted: {},
    totalPhrases: 0
  },
  metadata: {
    lastUpdated: (/* @__PURE__ */ new Date()).toISOString(),
    version: 1
  }
};
async function loadState() {
  try {
    const data = await fs.readFile(STATE_FILE, "utf8");
    return JSON.parse(data);
  } catch (error) {
    return { ...DEFAULT_STATE };
  }
}
async function saveState(state) {
  try {
    await fs.writeFile(STATE_FILE, JSON.stringify(state, null, 2));
    return true;
  } catch (error) {
    console.error("Error saving state:", error);
    return false;
  }
}
async function getState() {
  const globalState = await loadState();
  return {
    ...globalState,
    metadata: {
      ...globalState.metadata,
      retrieved: (/* @__PURE__ */ new Date()).toISOString()
    }
  };
}
async function updateState(updates, agentId = "user") {
  try {
    if (!updates || typeof updates !== "object") {
      throw new Error("Invalid updates provided");
    }
    let globalState = await loadState();
    globalState = deepMerge(globalState, updates);
    globalState.metadata.lastUpdated = (/* @__PURE__ */ new Date()).toISOString();
    globalState.metadata.version = (globalState.metadata.version || 1) + 1;
    await saveState(globalState);
    return {
      success: true,
      state: await getState()
    };
  } catch (error) {
    return {
      success: false,
      error: error.message
    };
  }
}
async function resetState() {
  const globalState = {
    styleGuide: {
      conversationLanguage: "English",
      // Language of Wider Communication
      sourceLanguage: "English",
      // Translating from
      targetLanguage: "English",
      // Translating into
      languagePair: "English \u2192 English",
      // Legacy, kept for compatibility
      readingLevel: "Grade 1",
      tone: "Narrator, engaging tone",
      philosophy: "Meaning-based"
    },
    glossary: {
      terms: {}
    },
    scriptureCanvas: {
      verses: {}
    },
    feedback: {
      comments: []
    },
    workflow: {
      currentPhase: "planning",
      currentVerse: "Ruth 1:1",
      currentPhrase: 0,
      phrasesCompleted: {},
      totalPhrases: 0
    },
    metadata: {
      lastUpdated: (/* @__PURE__ */ new Date()).toISOString(),
      version: 1
    }
  };
  await saveState(globalState);
  return getState();
}
function deepMerge(target, source) {
  const output = { ...target };
  if (isObject(target) && isObject(source)) {
    Object.keys(source).forEach((key) => {
      if (isObject(source[key])) {
        if (!(key in target)) {
          output[key] = source[key];
        } else {
          output[key] = deepMerge(target[key], source[key]);
        }
      } else {
        output[key] = source[key];
      }
    });
  }
  return output;
}
function isObject(item) {
  return item && typeof item === "object" && !Array.isArray(item);
}
var handler = async (req, context) => {
  const headers = {
    "Access-Control-Allow-Origin": "*",
    "Access-Control-Allow-Headers": "Content-Type",
    "Access-Control-Allow-Methods": "GET, POST, PUT, DELETE, OPTIONS",
    "Content-Type": "application/json"
  };
  if (req.method === "OPTIONS") {
    return new Response("OK", { headers });
  }
  try {
    const url = new URL(req.url);
    const path = url.pathname.replace("/.netlify/functions/canvas-state", "");
    if (req.method === "GET" && (path === "" || path === "/")) {
      const state = await getState();
      return new Response(JSON.stringify(state), {
        status: 200,
        headers
      });
    }
    if (req.method === "GET" && path === "/history") {
      const state = await getState();
      return new Response(
        JSON.stringify({
          history: [],
          // No longer storing history with file-based approach
          currentState: state
        }),
        {
          status: 200,
          headers
        }
      );
    }
    if (req.method === "POST" && path === "/update") {
      const body = await req.json();
      const { updates, agentId } = body;
      const result = await updateState(updates, agentId);
      return new Response(JSON.stringify(result), {
        status: result.success ? 200 : 400,
        headers
      });
    }
    if (req.method === "POST" && path === "/reset") {
      const state = await resetState();
      return new Response(
        JSON.stringify({
          success: true,
          state
        }),
        {
          status: 200,
          headers
        }
      );
    }
    return new Response(
      JSON.stringify({
        error: `Method ${req.method} not allowed for path ${path}`
      }),
      {
        status: 405,
        headers
      }
    );
  } catch (error) {
    console.error("Canvas state error:", error);
    return new Response(
      JSON.stringify({
        error: "Failed to process canvas state request",
        details: error.message
      }),
      {
        status: 500,
        headers: {
          ...headers,
          "Content-Type": "application/json"
        }
      }
    );
  }
};
var canvas_state_default = handler;
export {
  canvas_state_default as default
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibmV0bGlmeS9mdW5jdGlvbnMvY2FudmFzLXN0YXRlLmpzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWyIvKipcbiAqIENhbnZhcyBTdGF0ZSBNYW5hZ2VtZW50XG4gKiBNYW5hZ2VzIHRoZSBzdGF0ZSBvZiBhbGwgY2FudmFzIGFydGlmYWN0cyBzZXJ2ZXItc2lkZVxuICogVGhpcyBpcyB0aGUgc2luZ2xlIHNvdXJjZSBvZiB0cnV0aCBmb3IgdGhlIGFwcGxpY2F0aW9uIHN0YXRlXG4gKi9cblxuaW1wb3J0IHsgcHJvbWlzZXMgYXMgZnMgfSBmcm9tIFwiZnNcIjtcbmltcG9ydCB7IGpvaW4gfSBmcm9tIFwicGF0aFwiO1xuXG4vLyBTdGF0ZSBmaWxlIHBhdGggKGluIHRlbXAgZGlyZWN0b3J5IGZvciBsb2NhbCBkZXYpXG5jb25zdCBTVEFURV9GSUxFID0gam9pbihcIi90bXBcIiwgXCJjYW52YXMtc3RhdGUuanNvblwiKTtcblxuLy8gRGVmYXVsdCBzdGF0ZVxuY29uc3QgREVGQVVMVF9TVEFURSA9IHtcbiAgc3R5bGVHdWlkZToge1xuICAgIGNvbnZlcnNhdGlvbkxhbmd1YWdlOiBcIkVuZ2xpc2hcIiwgLy8gTGFuZ3VhZ2Ugb2YgV2lkZXIgQ29tbXVuaWNhdGlvblxuICAgIHNvdXJjZUxhbmd1YWdlOiBcIkVuZ2xpc2hcIiwgLy8gVHJhbnNsYXRpbmcgZnJvbVxuICAgIHRhcmdldExhbmd1YWdlOiBcIkVuZ2xpc2hcIiwgLy8gVHJhbnNsYXRpbmcgaW50b1xuICAgIGxhbmd1YWdlUGFpcjogXCJFbmdsaXNoIFx1MjE5MiBFbmdsaXNoXCIsIC8vIExlZ2FjeSwga2VwdCBmb3IgY29tcGF0aWJpbGl0eVxuICAgIHJlYWRpbmdMZXZlbDogXCJHcmFkZSAxXCIsXG4gICAgdG9uZTogXCJOYXJyYXRvciwgZW5nYWdpbmcgdG9uZVwiLFxuICAgIHBoaWxvc29waHk6IFwiTWVhbmluZy1iYXNlZFwiLFxuICB9LFxuICBnbG9zc2FyeToge1xuICAgIHRlcm1zOiB7fSxcbiAgfSxcbiAgc2NyaXB0dXJlQ2FudmFzOiB7XG4gICAgdmVyc2VzOiB7fSxcbiAgfSxcbiAgZmVlZGJhY2s6IHtcbiAgICBjb21tZW50czogW10sXG4gIH0sXG4gIHdvcmtmbG93OiB7XG4gICAgY3VycmVudFBoYXNlOiBcInBsYW5uaW5nXCIsXG4gICAgY3VycmVudFZlcnNlOiBcIlJ1dGggMToxXCIsXG4gICAgY3VycmVudFBocmFzZTogMCxcbiAgICBwaHJhc2VzQ29tcGxldGVkOiB7fSxcbiAgICB0b3RhbFBocmFzZXM6IDAsXG4gIH0sXG4gIG1ldGFkYXRhOiB7XG4gICAgbGFzdFVwZGF0ZWQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICB2ZXJzaW9uOiAxLFxuICB9LFxufTtcblxuLyoqXG4gKiBMb2FkIHN0YXRlIGZyb20gZmlsZSBvciByZXR1cm4gZGVmYXVsdFxuICovXG5hc3luYyBmdW5jdGlvbiBsb2FkU3RhdGUoKSB7XG4gIHRyeSB7XG4gICAgY29uc3QgZGF0YSA9IGF3YWl0IGZzLnJlYWRGaWxlKFNUQVRFX0ZJTEUsIFwidXRmOFwiKTtcbiAgICByZXR1cm4gSlNPTi5wYXJzZShkYXRhKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAvLyBGaWxlIGRvZXNuJ3QgZXhpc3Qgb3IgaXMgaW52YWxpZCwgcmV0dXJuIGRlZmF1bHRcbiAgICByZXR1cm4geyAuLi5ERUZBVUxUX1NUQVRFIH07XG4gIH1cbn1cblxuLyoqXG4gKiBTYXZlIHN0YXRlIHRvIGZpbGVcbiAqL1xuYXN5bmMgZnVuY3Rpb24gc2F2ZVN0YXRlKHN0YXRlKSB7XG4gIHRyeSB7XG4gICAgYXdhaXQgZnMud3JpdGVGaWxlKFNUQVRFX0ZJTEUsIEpTT04uc3RyaW5naWZ5KHN0YXRlLCBudWxsLCAyKSk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yIHNhdmluZyBzdGF0ZTpcIiwgZXJyb3IpO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufVxuXG4vKipcbiAqIEdldCB0aGUgY3VycmVudCBzdGF0ZVxuICovXG5hc3luYyBmdW5jdGlvbiBnZXRTdGF0ZSgpIHtcbiAgY29uc3QgZ2xvYmFsU3RhdGUgPSBhd2FpdCBsb2FkU3RhdGUoKTtcbiAgcmV0dXJuIHtcbiAgICAuLi5nbG9iYWxTdGF0ZSxcbiAgICBtZXRhZGF0YToge1xuICAgICAgLi4uZ2xvYmFsU3RhdGUubWV0YWRhdGEsXG4gICAgICByZXRyaWV2ZWQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICB9LFxuICB9O1xufVxuXG4vKipcbiAqIFVwZGF0ZSB0aGUgc3RhdGUgd2l0aCB2YWxpZGF0aW9uXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHVwZGF0ZVN0YXRlKHVwZGF0ZXMsIGFnZW50SWQgPSBcInVzZXJcIikge1xuICB0cnkge1xuICAgIC8vIFZhbGlkYXRlIHVwZGF0ZXNcbiAgICBpZiAoIXVwZGF0ZXMgfHwgdHlwZW9mIHVwZGF0ZXMgIT09IFwib2JqZWN0XCIpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgdXBkYXRlcyBwcm92aWRlZFwiKTtcbiAgICB9XG5cbiAgICAvLyBMb2FkIGN1cnJlbnQgc3RhdGVcbiAgICBsZXQgZ2xvYmFsU3RhdGUgPSBhd2FpdCBsb2FkU3RhdGUoKTtcblxuICAgIC8vIEFwcGx5IHVwZGF0ZXMgKGRlZXAgbWVyZ2UpXG4gICAgZ2xvYmFsU3RhdGUgPSBkZWVwTWVyZ2UoZ2xvYmFsU3RhdGUsIHVwZGF0ZXMpO1xuXG4gICAgLy8gVXBkYXRlIG1ldGFkYXRhXG4gICAgZ2xvYmFsU3RhdGUubWV0YWRhdGEubGFzdFVwZGF0ZWQgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG4gICAgZ2xvYmFsU3RhdGUubWV0YWRhdGEudmVyc2lvbiA9IChnbG9iYWxTdGF0ZS5tZXRhZGF0YS52ZXJzaW9uIHx8IDEpICsgMTtcblxuICAgIC8vIFNhdmUgdG8gZmlsZVxuICAgIGF3YWl0IHNhdmVTdGF0ZShnbG9iYWxTdGF0ZSk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIHN0YXRlOiBhd2FpdCBnZXRTdGF0ZSgpLFxuICAgIH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2UsXG4gICAgfTtcbiAgfVxufVxuXG4vKipcbiAqIFJlc2V0IHN0YXRlIHRvIGluaXRpYWwgdmFsdWVzXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHJlc2V0U3RhdGUoKSB7XG4gIGNvbnN0IGdsb2JhbFN0YXRlID0ge1xuICAgIHN0eWxlR3VpZGU6IHtcbiAgICAgIGNvbnZlcnNhdGlvbkxhbmd1YWdlOiBcIkVuZ2xpc2hcIiwgLy8gTGFuZ3VhZ2Ugb2YgV2lkZXIgQ29tbXVuaWNhdGlvblxuICAgICAgc291cmNlTGFuZ3VhZ2U6IFwiRW5nbGlzaFwiLCAvLyBUcmFuc2xhdGluZyBmcm9tXG4gICAgICB0YXJnZXRMYW5ndWFnZTogXCJFbmdsaXNoXCIsIC8vIFRyYW5zbGF0aW5nIGludG9cbiAgICAgIGxhbmd1YWdlUGFpcjogXCJFbmdsaXNoIFx1MjE5MiBFbmdsaXNoXCIsIC8vIExlZ2FjeSwga2VwdCBmb3IgY29tcGF0aWJpbGl0eVxuICAgICAgcmVhZGluZ0xldmVsOiBcIkdyYWRlIDFcIixcbiAgICAgIHRvbmU6IFwiTmFycmF0b3IsIGVuZ2FnaW5nIHRvbmVcIixcbiAgICAgIHBoaWxvc29waHk6IFwiTWVhbmluZy1iYXNlZFwiLFxuICAgIH0sXG4gICAgZ2xvc3Nhcnk6IHtcbiAgICAgIHRlcm1zOiB7fSxcbiAgICB9LFxuICAgIHNjcmlwdHVyZUNhbnZhczoge1xuICAgICAgdmVyc2VzOiB7fSxcbiAgICB9LFxuICAgIGZlZWRiYWNrOiB7XG4gICAgICBjb21tZW50czogW10sXG4gICAgfSxcbiAgICB3b3JrZmxvdzoge1xuICAgICAgY3VycmVudFBoYXNlOiBcInBsYW5uaW5nXCIsXG4gICAgICBjdXJyZW50VmVyc2U6IFwiUnV0aCAxOjFcIixcbiAgICAgIGN1cnJlbnRQaHJhc2U6IDAsXG4gICAgICBwaHJhc2VzQ29tcGxldGVkOiB7fSxcbiAgICAgIHRvdGFsUGhyYXNlczogMCxcbiAgICB9LFxuICAgIG1ldGFkYXRhOiB7XG4gICAgICBsYXN0VXBkYXRlZDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgdmVyc2lvbjogMSxcbiAgICB9LFxuICB9O1xuICBhd2FpdCBzYXZlU3RhdGUoZ2xvYmFsU3RhdGUpO1xuICByZXR1cm4gZ2V0U3RhdGUoKTtcbn1cblxuLyoqXG4gKiBEZWVwIG1lcmdlIHV0aWxpdHkgZnVuY3Rpb25cbiAqL1xuZnVuY3Rpb24gZGVlcE1lcmdlKHRhcmdldCwgc291cmNlKSB7XG4gIGNvbnN0IG91dHB1dCA9IHsgLi4udGFyZ2V0IH07XG5cbiAgaWYgKGlzT2JqZWN0KHRhcmdldCkgJiYgaXNPYmplY3Qoc291cmNlKSkge1xuICAgIE9iamVjdC5rZXlzKHNvdXJjZSkuZm9yRWFjaCgoa2V5KSA9PiB7XG4gICAgICBpZiAoaXNPYmplY3Qoc291cmNlW2tleV0pKSB7XG4gICAgICAgIGlmICghKGtleSBpbiB0YXJnZXQpKSB7XG4gICAgICAgICAgb3V0cHV0W2tleV0gPSBzb3VyY2Vba2V5XTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBvdXRwdXRba2V5XSA9IGRlZXBNZXJnZSh0YXJnZXRba2V5XSwgc291cmNlW2tleV0pO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBvdXRwdXRba2V5XSA9IHNvdXJjZVtrZXldO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgcmV0dXJuIG91dHB1dDtcbn1cblxuZnVuY3Rpb24gaXNPYmplY3QoaXRlbSkge1xuICByZXR1cm4gaXRlbSAmJiB0eXBlb2YgaXRlbSA9PT0gXCJvYmplY3RcIiAmJiAhQXJyYXkuaXNBcnJheShpdGVtKTtcbn1cblxuLyoqXG4gKiBOZXRsaWZ5IEZ1bmN0aW9uIEhhbmRsZXJcbiAqL1xuY29uc3QgaGFuZGxlciA9IGFzeW5jIChyZXEsIGNvbnRleHQpID0+IHtcbiAgLy8gRW5hYmxlIENPUlNcbiAgY29uc3QgaGVhZGVycyA9IHtcbiAgICBcIkFjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpblwiOiBcIipcIixcbiAgICBcIkFjY2Vzcy1Db250cm9sLUFsbG93LUhlYWRlcnNcIjogXCJDb250ZW50LVR5cGVcIixcbiAgICBcIkFjY2Vzcy1Db250cm9sLUFsbG93LU1ldGhvZHNcIjogXCJHRVQsIFBPU1QsIFBVVCwgREVMRVRFLCBPUFRJT05TXCIsXG4gICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gIH07XG5cbiAgLy8gSGFuZGxlIHByZWZsaWdodFxuICBpZiAocmVxLm1ldGhvZCA9PT0gXCJPUFRJT05TXCIpIHtcbiAgICByZXR1cm4gbmV3IFJlc3BvbnNlKFwiT0tcIiwgeyBoZWFkZXJzIH0pO1xuICB9XG5cbiAgdHJ5IHtcbiAgICBjb25zdCB1cmwgPSBuZXcgVVJMKHJlcS51cmwpO1xuICAgIGNvbnN0IHBhdGggPSB1cmwucGF0aG5hbWUucmVwbGFjZShcIi8ubmV0bGlmeS9mdW5jdGlvbnMvY2FudmFzLXN0YXRlXCIsIFwiXCIpO1xuXG4gICAgLy8gR0VUIC9zdGF0ZSAtIEdldCBjdXJyZW50IHN0YXRlXG4gICAgaWYgKHJlcS5tZXRob2QgPT09IFwiR0VUXCIgJiYgKHBhdGggPT09IFwiXCIgfHwgcGF0aCA9PT0gXCIvXCIpKSB7XG4gICAgICBjb25zdCBzdGF0ZSA9IGF3YWl0IGdldFN0YXRlKCk7XG4gICAgICByZXR1cm4gbmV3IFJlc3BvbnNlKEpTT04uc3RyaW5naWZ5KHN0YXRlKSwge1xuICAgICAgICBzdGF0dXM6IDIwMCxcbiAgICAgICAgaGVhZGVycyxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIEdFVCAvaGlzdG9yeSAtIEdldCBzdGF0ZSBoaXN0b3J5IChkZXByZWNhdGVkIGZvciBmaWxlLWJhc2VkIHN0b3JhZ2UpXG4gICAgaWYgKHJlcS5tZXRob2QgPT09IFwiR0VUXCIgJiYgcGF0aCA9PT0gXCIvaGlzdG9yeVwiKSB7XG4gICAgICBjb25zdCBzdGF0ZSA9IGF3YWl0IGdldFN0YXRlKCk7XG4gICAgICByZXR1cm4gbmV3IFJlc3BvbnNlKFxuICAgICAgICBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgaGlzdG9yeTogW10sIC8vIE5vIGxvbmdlciBzdG9yaW5nIGhpc3Rvcnkgd2l0aCBmaWxlLWJhc2VkIGFwcHJvYWNoXG4gICAgICAgICAgY3VycmVudFN0YXRlOiBzdGF0ZSxcbiAgICAgICAgfSksXG4gICAgICAgIHtcbiAgICAgICAgICBzdGF0dXM6IDIwMCxcbiAgICAgICAgICBoZWFkZXJzLFxuICAgICAgICB9XG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIFBPU1QgL3VwZGF0ZSAtIFVwZGF0ZSBzdGF0ZVxuICAgIGlmIChyZXEubWV0aG9kID09PSBcIlBPU1RcIiAmJiBwYXRoID09PSBcIi91cGRhdGVcIikge1xuICAgICAgY29uc3QgYm9keSA9IGF3YWl0IHJlcS5qc29uKCk7XG4gICAgICBjb25zdCB7IHVwZGF0ZXMsIGFnZW50SWQgfSA9IGJvZHk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHVwZGF0ZVN0YXRlKHVwZGF0ZXMsIGFnZW50SWQpO1xuXG4gICAgICByZXR1cm4gbmV3IFJlc3BvbnNlKEpTT04uc3RyaW5naWZ5KHJlc3VsdCksIHtcbiAgICAgICAgc3RhdHVzOiByZXN1bHQuc3VjY2VzcyA/IDIwMCA6IDQwMCxcbiAgICAgICAgaGVhZGVycyxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIFBPU1QgL3Jlc2V0IC0gUmVzZXQgc3RhdGVcbiAgICBpZiAocmVxLm1ldGhvZCA9PT0gXCJQT1NUXCIgJiYgcGF0aCA9PT0gXCIvcmVzZXRcIikge1xuICAgICAgY29uc3Qgc3RhdGUgPSBhd2FpdCByZXNldFN0YXRlKCk7XG5cbiAgICAgIHJldHVybiBuZXcgUmVzcG9uc2UoXG4gICAgICAgIEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgIHN0YXRlLFxuICAgICAgICB9KSxcbiAgICAgICAge1xuICAgICAgICAgIHN0YXR1czogMjAwLFxuICAgICAgICAgIGhlYWRlcnMsXG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gTWV0aG9kIG5vdCBhbGxvd2VkXG4gICAgcmV0dXJuIG5ldyBSZXNwb25zZShcbiAgICAgIEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgZXJyb3I6IGBNZXRob2QgJHtyZXEubWV0aG9kfSBub3QgYWxsb3dlZCBmb3IgcGF0aCAke3BhdGh9YCxcbiAgICAgIH0pLFxuICAgICAge1xuICAgICAgICBzdGF0dXM6IDQwNSxcbiAgICAgICAgaGVhZGVycyxcbiAgICAgIH1cbiAgICApO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJDYW52YXMgc3RhdGUgZXJyb3I6XCIsIGVycm9yKTtcbiAgICByZXR1cm4gbmV3IFJlc3BvbnNlKFxuICAgICAgSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBlcnJvcjogXCJGYWlsZWQgdG8gcHJvY2VzcyBjYW52YXMgc3RhdGUgcmVxdWVzdFwiLFxuICAgICAgICBkZXRhaWxzOiBlcnJvci5tZXNzYWdlLFxuICAgICAgfSksXG4gICAgICB7XG4gICAgICAgIHN0YXR1czogNTAwLFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgLi4uaGVhZGVycyxcbiAgICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgICAgfSxcbiAgICAgIH1cbiAgICApO1xuICB9XG59O1xuXG5leHBvcnQgZGVmYXVsdCBoYW5kbGVyO1xuIl0sCiAgIm1hcHBpbmdzIjogIjs7Ozs7Ozs7OztBQU1BLFNBQVMsWUFBWSxVQUFVO0FBQy9CLFNBQVMsWUFBWTtBQUdyQixJ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
