
import {createRequire as ___nfyCreateRequire} from "module";
import {fileURLToPath as ___nfyFileURLToPath} from "url";
import {dirname as ___nfyPathDirname} from "path";
let __filename=___nfyFileURLToPath(import.meta.url);
let __dirname=___nfyPathDirname(___nfyFileURLToPath(import.meta.url));
let require=___nfyCreateRequire(import.meta.url);


// netlify/functions/canvas-state.js
import { getStore } from "@netlify/blobs";
var DEFAULT_STATE = {
  styleGuide: {
    conversationLanguage: "English",
    // Default value
    sourceLanguage: "English",
    // Default value
    targetLanguage: "English",
    // Default value
    languagePair: "English \u2192 English",
    // Legacy, kept for compatibility
    readingLevel: "Grade 1",
    // Default value
    tone: "Straightforward and hopeful",
    // Default value
    philosophy: "Meaning-based",
    // Default value
    approach: "Dynamic",
    // Translation approach default
    targetCommunity: "Teens"
    // Default audience
  },
  settingsCustomized: false,
  // Track if user has customized settings
  glossary: {
    terms: {}
  },
  scriptureCanvas: {
    verses: {}
  },
  feedback: {
    comments: []
  },
  workflow: {
    currentPhase: "planning",
    currentVerse: "Ruth 1:1",
    // Default verse to work with
    currentPhrase: 0,
    phrasesCompleted: {},
    totalPhrases: 0
  },
  metadata: {
    lastUpdated: (/* @__PURE__ */ new Date()).toISOString(),
    version: 1
  }
};
function getBlobStore(context) {
  const storeConfig = {
    name: "canvas-state"
  };
  if (context.site?.id) {
    storeConfig.siteID = context.site.id;
  }
  if (context.token) {
    storeConfig.token = context.token;
  }
  return getStore(storeConfig);
}
function getStateKey(req) {
  const url = new URL(req.url);
  const sessionId = req.headers.get?.("x-session-id") || req.headers["x-session-id"] || url.searchParams.get("session");
  if (!sessionId) return "default";
  return sessionId.startsWith("session_") ? sessionId : `session_${sessionId}`;
}
async function loadState(store, stateKey) {
  try {
    const data = await store.get(stateKey);
    if (data) {
      return JSON.parse(data);
    }
    return { ...DEFAULT_STATE };
  } catch (error) {
    console.error("Error loading state from Blobs:", error);
    return { ...DEFAULT_STATE };
  }
}
async function saveState(store, stateKey, state) {
  try {
    await store.set(stateKey, JSON.stringify(state));
    return true;
  } catch (error) {
    console.error("Error saving state to Blobs:", error);
    return false;
  }
}
async function getState(store, stateKey) {
  const globalState = await loadState(store, stateKey);
  return {
    ...globalState,
    metadata: {
      ...globalState.metadata,
      retrieved: (/* @__PURE__ */ new Date()).toISOString(),
      sessionId: stateKey
    }
  };
}
async function updateState(store, stateKey, updates) {
  try {
    if (!updates || typeof updates !== "object") {
      throw new Error("Invalid updates provided");
    }
    let globalState = await loadState(store, stateKey);
    globalState = deepMerge(globalState, updates);
    globalState.metadata.lastUpdated = (/* @__PURE__ */ new Date()).toISOString();
    globalState.metadata.version = (globalState.metadata.version || 1) + 1;
    await saveState(store, stateKey, globalState);
    return {
      success: true,
      state: await getState(store, stateKey)
    };
  } catch (error) {
    return {
      success: false,
      error: error.message
    };
  }
}
async function resetState(store, stateKey) {
  const globalState = {
    ...DEFAULT_STATE,
    metadata: {
      lastUpdated: (/* @__PURE__ */ new Date()).toISOString(),
      version: 1,
      sessionId: stateKey
    }
  };
  await saveState(store, stateKey, globalState);
  return getState(store, stateKey);
}
async function listSessions(store) {
  try {
    const { blobs } = await store.list();
    return blobs.map((blob) => ({
      key: blob.key,
      // Extract session ID from key
      sessionId: blob.key.startsWith("session_") ? blob.key.replace("session_", "") : blob.key,
      isDefault: blob.key === "default"
    }));
  } catch (error) {
    console.error("Error listing sessions:", error);
    return [];
  }
}
function deepMerge(target, source) {
  const output = { ...target };
  if (isObject(target) && isObject(source)) {
    Object.keys(source).forEach((key) => {
      if (isObject(source[key])) {
        if (!(key in target)) {
          output[key] = source[key];
        } else {
          output[key] = deepMerge(target[key], source[key]);
        }
      } else {
        output[key] = source[key];
      }
    });
  }
  return output;
}
function isObject(item) {
  return item && typeof item === "object" && !Array.isArray(item);
}
var handler = async (req, context) => {
  const headers = {
    "Access-Control-Allow-Origin": "*",
    "Access-Control-Allow-Headers": "Content-Type, X-Session-ID",
    "Access-Control-Allow-Methods": "GET, POST, PUT, DELETE, OPTIONS",
    "Content-Type": "application/json"
  };
  if (req.method === "OPTIONS") {
    return new Response("OK", { headers });
  }
  try {
    const store = getBlobStore(context);
    const stateKey = getStateKey(req);
    const url = new URL(req.url);
    const path = url.pathname.replace("/.netlify/functions/canvas-state", "");
    console.log(`Canvas state request: ${req.method} ${path}, session: ${stateKey}`);
    if (req.method === "GET" && (path === "" || path === "/")) {
      const shouldReset = url.searchParams.get("reset") === "true";
      if (shouldReset) {
        console.log(`Resetting session via GET: ${stateKey}`);
        const state2 = await resetState(store, stateKey);
        return new Response(
          JSON.stringify({
            ...state2,
            metadata: {
              ...state2.metadata,
              reset: true,
              message: "Session reset successfully"
            }
          }),
          {
            status: 200,
            headers
          }
        );
      }
      const state = await getState(store, stateKey);
      return new Response(JSON.stringify(state), {
        status: 200,
        headers
      });
    }
    if (req.method === "GET" && path === "/sessions") {
      const sessions = await listSessions(store);
      return new Response(
        JSON.stringify({
          sessions,
          currentSession: stateKey
        }),
        {
          status: 200,
          headers
        }
      );
    }
    if (req.method === "GET" && path === "/history") {
      const state = await getState(store, stateKey);
      return new Response(
        JSON.stringify({
          history: [],
          // No longer storing history with Blobs approach
          currentState: state
        }),
        {
          status: 200,
          headers
        }
      );
    }
    if (req.method === "POST" && path === "/update") {
      const body = await req.json();
      const { updates, agentId } = body;
      const result = await updateState(store, stateKey, updates, agentId);
      return new Response(JSON.stringify(result), {
        status: result.success ? 200 : 400,
        headers
      });
    }
    if (req.method === "POST" && path === "/reset") {
      const state = await resetState(store, stateKey);
      return new Response(
        JSON.stringify({
          success: true,
          state
        }),
        {
          status: 200,
          headers
        }
      );
    }
    if (req.method === "DELETE" && path === "/session") {
      try {
        await store.delete(stateKey);
        return new Response(
          JSON.stringify({
            success: true,
            message: `Session ${stateKey} deleted`
          }),
          {
            status: 200,
            headers
          }
        );
      } catch (error) {
        return new Response(
          JSON.stringify({
            success: false,
            error: error.message
          }),
          {
            status: 500,
            headers
          }
        );
      }
    }
    return new Response(
      JSON.stringify({
        error: `Method ${req.method} not allowed for path ${path}`
      }),
      {
        status: 405,
        headers
      }
    );
  } catch (error) {
    console.error("Canvas state error:", error);
    return new Response(
      JSON.stringify({
        error: "Failed to process canvas state request",
        details: error.message
      }),
      {
        status: 500,
        headers: {
          ...headers,
          "Content-Type": "application/json"
        }
      }
    );
  }
};
var canvas_state_default = handler;
export {
  canvas_state_default as default
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibmV0bGlmeS9mdW5jdGlvbnMvY2FudmFzLXN0YXRlLmpzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWyIvKipcbiAqIENhbnZhcyBTdGF0ZSBNYW5hZ2VtZW50IHdpdGggTmV0bGlmeSBCbG9ic1xuICogTWFuYWdlcyB0aGUgc3RhdGUgb2YgYWxsIGNhbnZhcyBhcnRpZmFjdHMgdXNpbmcgTmV0bGlmeSBCbG9icyBmb3IgcGVyc2lzdGVuY2VcbiAqIFRoaXMgaXMgdGhlIHNpbmdsZSBzb3VyY2Ugb2YgdHJ1dGggZm9yIHRoZSBhcHBsaWNhdGlvbiBzdGF0ZVxuICovXG5cbmltcG9ydCB7IGdldFN0b3JlIH0gZnJvbSBcIkBuZXRsaWZ5L2Jsb2JzXCI7XG5cbi8vIERlZmF1bHQgc3RhdGVcbmNvbnN0IERFRkFVTFRfU1RBVEUgPSB7XG4gIHN0eWxlR3VpZGU6IHtcbiAgICBjb252ZXJzYXRpb25MYW5ndWFnZTogXCJFbmdsaXNoXCIsIC8vIERlZmF1bHQgdmFsdWVcbiAgICBzb3VyY2VMYW5ndWFnZTogXCJFbmdsaXNoXCIsIC8vIERlZmF1bHQgdmFsdWVcbiAgICB0YXJnZXRMYW5ndWFnZTogXCJFbmdsaXNoXCIsIC8vIERlZmF1bHQgdmFsdWVcbiAgICBsYW5ndWFnZVBhaXI6IFwiRW5nbGlzaCBcdTIxOTIgRW5nbGlzaFwiLCAvLyBMZWdhY3ksIGtlcHQgZm9yIGNvbXBhdGliaWxpdHlcbiAgICByZWFkaW5nTGV2ZWw6IFwiR3JhZGUgMVwiLCAvLyBEZWZhdWx0IHZhbHVlXG4gICAgdG9uZTogXCJTdHJhaWdodGZvcndhcmQgYW5kIGhvcGVmdWxcIiwgLy8gRGVmYXVsdCB2YWx1ZVxuICAgIHBoaWxvc29waHk6IFwiTWVhbmluZy1iYXNlZFwiLCAvLyBEZWZhdWx0IHZhbHVlXG4gICAgYXBwcm9hY2g6IFwiRHluYW1pY1wiLCAvLyBUcmFuc2xhdGlvbiBhcHByb2FjaCBkZWZhdWx0XG4gICAgdGFyZ2V0Q29tbXVuaXR5OiBcIlRlZW5zXCIsIC8vIERlZmF1bHQgYXVkaWVuY2VcbiAgfSxcbiAgc2V0dGluZ3NDdXN0b21pemVkOiBmYWxzZSwgLy8gVHJhY2sgaWYgdXNlciBoYXMgY3VzdG9taXplZCBzZXR0aW5nc1xuICBnbG9zc2FyeToge1xuICAgIHRlcm1zOiB7fSxcbiAgfSxcbiAgc2NyaXB0dXJlQ2FudmFzOiB7XG4gICAgdmVyc2VzOiB7fSxcbiAgfSxcbiAgZmVlZGJhY2s6IHtcbiAgICBjb21tZW50czogW10sXG4gIH0sXG4gIHdvcmtmbG93OiB7XG4gICAgY3VycmVudFBoYXNlOiBcInBsYW5uaW5nXCIsXG4gICAgY3VycmVudFZlcnNlOiBcIlJ1dGggMToxXCIsIC8vIERlZmF1bHQgdmVyc2UgdG8gd29yayB3aXRoXG4gICAgY3VycmVudFBocmFzZTogMCxcbiAgICBwaHJhc2VzQ29tcGxldGVkOiB7fSxcbiAgICB0b3RhbFBocmFzZXM6IDAsXG4gIH0sXG4gIG1ldGFkYXRhOiB7XG4gICAgbGFzdFVwZGF0ZWQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICB2ZXJzaW9uOiAxLFxuICB9LFxufTtcblxuLyoqXG4gKiBHZXQgdGhlIE5ldGxpZnkgQmxvYnMgc3RvcmUgZm9yIHRoZSBjdXJyZW50IHNpdGVcbiAqL1xuZnVuY3Rpb24gZ2V0QmxvYlN0b3JlKGNvbnRleHQpIHtcbiAgLy8gSW4gcHJvZHVjdGlvbiwgZ2V0U3RvcmUgc2hvdWxkIHdvcmsgd2l0aG91dCBleHBsaWNpdCBzaXRlSUQvdG9rZW5cbiAgLy8gYXMgTmV0bGlmeSBwcm92aWRlcyB0aGVzZSBhdXRvbWF0aWNhbGx5IGluIHRoZSBydW50aW1lIGVudmlyb25tZW50XG4gIGNvbnN0IHN0b3JlQ29uZmlnID0ge1xuICAgIG5hbWU6IFwiY2FudmFzLXN0YXRlXCIsXG4gIH07XG5cbiAgLy8gT25seSBhZGQgc2l0ZUlEIGFuZCB0b2tlbiBpZiB0aGV5IGV4aXN0IChmb3IgbG9jYWwgZGV2ZWxvcG1lbnQpXG4gIGlmIChjb250ZXh0LnNpdGU/LmlkKSB7XG4gICAgc3RvcmVDb25maWcuc2l0ZUlEID0gY29udGV4dC5zaXRlLmlkO1xuICB9XG5cbiAgaWYgKGNvbnRleHQudG9rZW4pIHtcbiAgICBzdG9yZUNvbmZpZy50b2tlbiA9IGNvbnRleHQudG9rZW47XG4gIH1cblxuICByZXR1cm4gZ2V0U3RvcmUoc3RvcmVDb25maWcpO1xufVxuXG4vKipcbiAqIEdldCBzZXNzaW9uLXNwZWNpZmljIHN0YXRlIGtleVxuICovXG5mdW5jdGlvbiBnZXRTdGF0ZUtleShyZXEpIHtcbiAgLy8gQ2hlY2sgZm9yIHNlc3Npb24gSUQgaW4gaGVhZGVycyBvciBxdWVyeSBwYXJhbXNcbiAgY29uc3QgdXJsID0gbmV3IFVSTChyZXEudXJsKTtcbiAgY29uc3Qgc2Vzc2lvbklkID1cbiAgICByZXEuaGVhZGVycy5nZXQ/LihcIngtc2Vzc2lvbi1pZFwiKSB8fFxuICAgIHJlcS5oZWFkZXJzW1wieC1zZXNzaW9uLWlkXCJdIHx8XG4gICAgdXJsLnNlYXJjaFBhcmFtcy5nZXQoXCJzZXNzaW9uXCIpO1xuXG4gIC8vIFVzZSBzZXNzaW9uLXNwZWNpZmljIGtleSBpZiBwcm92aWRlZCwgb3RoZXJ3aXNlIHVzZSBkZWZhdWx0XG4gIC8vIERvbid0IGRvdWJsZS1wcmVmaXggaWYgc2Vzc2lvbiBJRCBhbHJlYWR5IHN0YXJ0cyB3aXRoIFwic2Vzc2lvbl9cIlxuICBpZiAoIXNlc3Npb25JZCkgcmV0dXJuIFwiZGVmYXVsdFwiO1xuICByZXR1cm4gc2Vzc2lvbklkLnN0YXJ0c1dpdGgoXCJzZXNzaW9uX1wiKSA/IHNlc3Npb25JZCA6IGBzZXNzaW9uXyR7c2Vzc2lvbklkfWA7XG59XG5cbi8qKlxuICogTG9hZCBzdGF0ZSBmcm9tIEJsb2JzIG9yIHJldHVybiBkZWZhdWx0XG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGxvYWRTdGF0ZShzdG9yZSwgc3RhdGVLZXkpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBkYXRhID0gYXdhaXQgc3RvcmUuZ2V0KHN0YXRlS2V5KTtcbiAgICBpZiAoZGF0YSkge1xuICAgICAgcmV0dXJuIEpTT04ucGFyc2UoZGF0YSk7XG4gICAgfVxuICAgIC8vIE5vIGV4aXN0aW5nIHN0YXRlLCByZXR1cm4gZGVmYXVsdFxuICAgIHJldHVybiB7IC4uLkRFRkFVTFRfU1RBVEUgfTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgbG9hZGluZyBzdGF0ZSBmcm9tIEJsb2JzOlwiLCBlcnJvcik7XG4gICAgLy8gUmV0dXJuIGRlZmF1bHQgc3RhdGUgb24gZXJyb3JcbiAgICByZXR1cm4geyAuLi5ERUZBVUxUX1NUQVRFIH07XG4gIH1cbn1cblxuLyoqXG4gKiBTYXZlIHN0YXRlIHRvIEJsb2JzXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHNhdmVTdGF0ZShzdG9yZSwgc3RhdGVLZXksIHN0YXRlKSB7XG4gIHRyeSB7XG4gICAgYXdhaXQgc3RvcmUuc2V0KHN0YXRlS2V5LCBKU09OLnN0cmluZ2lmeShzdGF0ZSkpO1xuICAgIHJldHVybiB0cnVlO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBzYXZpbmcgc3RhdGUgdG8gQmxvYnM6XCIsIGVycm9yKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn1cblxuLyoqXG4gKiBHZXQgdGhlIGN1cnJlbnQgc3RhdGVcbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2V0U3RhdGUoc3RvcmUsIHN0YXRlS2V5KSB7XG4gIGNvbnN0IGdsb2JhbFN0YXRlID0gYXdhaXQgbG9hZFN0YXRlKHN0b3JlLCBzdGF0ZUtleSk7XG4gIHJldHVybiB7XG4gICAgLi4uZ2xvYmFsU3RhdGUsXG4gICAgbWV0YWRhdGE6IHtcbiAgICAgIC4uLmdsb2JhbFN0YXRlLm1ldGFkYXRhLFxuICAgICAgcmV0cmlldmVkOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICBzZXNzaW9uSWQ6IHN0YXRlS2V5LFxuICAgIH0sXG4gIH07XG59XG5cbi8qKlxuICogVXBkYXRlIHRoZSBzdGF0ZSB3aXRoIHZhbGlkYXRpb25cbiAqL1xuYXN5bmMgZnVuY3Rpb24gdXBkYXRlU3RhdGUoc3RvcmUsIHN0YXRlS2V5LCB1cGRhdGVzKSB7XG4gIHRyeSB7XG4gICAgLy8gVmFsaWRhdGUgdXBkYXRlc1xuICAgIGlmICghdXBkYXRlcyB8fCB0eXBlb2YgdXBkYXRlcyAhPT0gXCJvYmplY3RcIikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCB1cGRhdGVzIHByb3ZpZGVkXCIpO1xuICAgIH1cblxuICAgIC8vIExvYWQgY3VycmVudCBzdGF0ZVxuICAgIGxldCBnbG9iYWxTdGF0ZSA9IGF3YWl0IGxvYWRTdGF0ZShzdG9yZSwgc3RhdGVLZXkpO1xuXG4gICAgLy8gQXBwbHkgdXBkYXRlcyAoZGVlcCBtZXJnZSlcbiAgICBnbG9iYWxTdGF0ZSA9IGRlZXBNZXJnZShnbG9iYWxTdGF0ZSwgdXBkYXRlcyk7XG5cbiAgICAvLyBVcGRhdGUgbWV0YWRhdGFcbiAgICBnbG9iYWxTdGF0ZS5tZXRhZGF0YS5sYXN0VXBkYXRlZCA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcbiAgICBnbG9iYWxTdGF0ZS5tZXRhZGF0YS52ZXJzaW9uID0gKGdsb2JhbFN0YXRlLm1ldGFkYXRhLnZlcnNpb24gfHwgMSkgKyAxO1xuXG4gICAgLy8gU2F2ZSB0byBCbG9ic1xuICAgIGF3YWl0IHNhdmVTdGF0ZShzdG9yZSwgc3RhdGVLZXksIGdsb2JhbFN0YXRlKTtcblxuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgc3RhdGU6IGF3YWl0IGdldFN0YXRlKHN0b3JlLCBzdGF0ZUtleSksXG4gICAgfTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBlcnJvcjogZXJyb3IubWVzc2FnZSxcbiAgICB9O1xuICB9XG59XG5cbi8qKlxuICogUmVzZXQgc3RhdGUgdG8gaW5pdGlhbCB2YWx1ZXNcbiAqL1xuYXN5bmMgZnVuY3Rpb24gcmVzZXRTdGF0ZShzdG9yZSwgc3RhdGVLZXkpIHtcbiAgY29uc3QgZ2xvYmFsU3RhdGUgPSB7XG4gICAgLi4uREVGQVVMVF9TVEFURSxcbiAgICBtZXRhZGF0YToge1xuICAgICAgbGFzdFVwZGF0ZWQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgIHZlcnNpb246IDEsXG4gICAgICBzZXNzaW9uSWQ6IHN0YXRlS2V5LFxuICAgIH0sXG4gIH07XG4gIGF3YWl0IHNhdmVTdGF0ZShzdG9yZSwgc3RhdGVLZXksIGdsb2JhbFN0YXRlKTtcbiAgcmV0dXJuIGdldFN0YXRlKHN0b3JlLCBzdGF0ZUtleSk7XG59XG5cbi8qKlxuICogTGlzdCBhbGwgc2Vzc2lvbnMgKGZvciBhZG1pbi9kZWJ1ZyBwdXJwb3NlcylcbiAqL1xuYXN5bmMgZnVuY3Rpb24gbGlzdFNlc3Npb25zKHN0b3JlKSB7XG4gIHRyeSB7XG4gICAgY29uc3QgeyBibG9icyB9ID0gYXdhaXQgc3RvcmUubGlzdCgpO1xuICAgIHJldHVybiBibG9icy5tYXAoKGJsb2IpID0+ICh7XG4gICAgICBrZXk6IGJsb2Iua2V5LFxuICAgICAgLy8gRXh0cmFjdCBzZXNzaW9uIElEIGZyb20ga2V5XG4gICAgICBzZXNzaW9uSWQ6IGJsb2Iua2V5LnN0YXJ0c1dpdGgoXCJzZXNzaW9uX1wiKSA/IGJsb2Iua2V5LnJlcGxhY2UoXCJzZXNzaW9uX1wiLCBcIlwiKSA6IGJsb2Iua2V5LFxuICAgICAgaXNEZWZhdWx0OiBibG9iLmtleSA9PT0gXCJkZWZhdWx0XCIsXG4gICAgfSkpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBsaXN0aW5nIHNlc3Npb25zOlwiLCBlcnJvcik7XG4gICAgcmV0dXJuIFtdO1xuICB9XG59XG5cbi8qKlxuICogRGVlcCBtZXJnZSB1dGlsaXR5IGZ1bmN0aW9uXG4gKi9cbmZ1bmN0aW9uIGRlZXBNZXJnZSh0YXJnZXQsIHNvdXJjZSkge1xuICBjb25zdCBvdXRwdXQgPSB7IC4uLnRhcmdldCB9O1xuXG4gIGlmIChpc09iamVjdCh0YXJnZXQpICYmIGlzT2JqZWN0KHNvdXJjZSkpIHtcbiAgICBPYmplY3Qua2V5cyhzb3VyY2UpLmZvckVhY2goKGtleSkgPT4ge1xuICAgICAgaWYgKGlzT2JqZWN0KHNvdXJjZVtrZXldKSkge1xuICAgICAgICBpZiAoIShrZXkgaW4gdGFyZ2V0KSkge1xuICAgICAgICAgIG91dHB1dFtrZXldID0gc291cmNlW2tleV07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgb3V0cHV0W2tleV0gPSBkZWVwTWVyZ2UodGFyZ2V0W2tleV0sIHNvdXJjZVtrZXldKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgb3V0cHV0W2tleV0gPSBzb3VyY2Vba2V5XTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHJldHVybiBvdXRwdXQ7XG59XG5cbmZ1bmN0aW9uIGlzT2JqZWN0KGl0ZW0pIHtcbiAgcmV0dXJuIGl0ZW0gJiYgdHlwZW9mIGl0ZW0gPT09IFwib2JqZWN0XCIgJiYgIUFycmF5LmlzQXJyYXkoaXRlbSk7XG59XG5cbi8qKlxuICogTmV0bGlmeSBGdW5jdGlvbiBIYW5kbGVyXG4gKi9cbmNvbnN0IGhhbmRsZXIgPSBhc3luYyAocmVxLCBjb250ZXh0KSA9PiB7XG4gIC8vIEVuYWJsZSBDT1JTXG4gIGNvbnN0IGhlYWRlcnMgPSB7XG4gICAgXCJBY2Nlc3MtQ29udHJvbC1BbGxvdy1PcmlnaW5cIjogXCIqXCIsXG4gICAgXCJBY2Nlc3MtQ29udHJvbC1BbGxvdy1IZWFkZXJzXCI6IFwiQ29udGVudC1UeXBlLCBYLVNlc3Npb24tSURcIixcbiAgICBcIkFjY2Vzcy1Db250cm9sLUFsbG93LU1ldGhvZHNcIjogXCJHRVQsIFBPU1QsIFBVVCwgREVMRVRFLCBPUFRJT05TXCIsXG4gICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gIH07XG5cbiAgLy8gSGFuZGxlIHByZWZsaWdodFxuICBpZiAocmVxLm1ldGhvZCA9PT0gXCJPUFRJT05TXCIpIHtcbiAgICByZXR1cm4gbmV3IFJlc3BvbnNlKFwiT0tcIiwgeyBoZWFkZXJzIH0pO1xuICB9XG5cbiAgdHJ5IHtcbiAgICAvLyBHZXQgdGhlIEJsb2JzIHN0b3JlXG4gICAgY29uc3Qgc3RvcmUgPSBnZXRCbG9iU3RvcmUoY29udGV4dCk7XG5cbiAgICAvLyBHZXQgdGhlIHN0YXRlIGtleSAoc2Vzc2lvbi1zcGVjaWZpYyBvciBkZWZhdWx0KVxuICAgIGNvbnN0IHN0YXRlS2V5ID0gZ2V0U3RhdGVLZXkocmVxKTtcblxuICAgIGNvbnN0IHVybCA9IG5ldyBVUkwocmVxLnVybCk7XG4gICAgY29uc3QgcGF0aCA9IHVybC5wYXRobmFtZS5yZXBsYWNlKFwiLy5uZXRsaWZ5L2Z1bmN0aW9ucy9jYW52YXMtc3RhdGVcIiwgXCJcIik7XG5cbiAgICAvLyBMb2cgZm9yIGRlYnVnZ2luZ1xuICAgIGNvbnNvbGUubG9nKGBDYW52YXMgc3RhdGUgcmVxdWVzdDogJHtyZXEubWV0aG9kfSAke3BhdGh9LCBzZXNzaW9uOiAke3N0YXRlS2V5fWApO1xuXG4gICAgLy8gR0VUIC9zdGF0ZSAtIEdldCBjdXJyZW50IHN0YXRlICh3aXRoIG9wdGlvbmFsIHJlc2V0KVxuICAgIGlmIChyZXEubWV0aG9kID09PSBcIkdFVFwiICYmIChwYXRoID09PSBcIlwiIHx8IHBhdGggPT09IFwiL1wiKSkge1xuICAgICAgLy8gQ2hlY2sgZm9yIHJlc2V0IGZsYWcgaW4gcXVlcnkgcGFyYW1zXG4gICAgICBjb25zdCBzaG91bGRSZXNldCA9IHVybC5zZWFyY2hQYXJhbXMuZ2V0KFwicmVzZXRcIikgPT09IFwidHJ1ZVwiO1xuXG4gICAgICBpZiAoc2hvdWxkUmVzZXQpIHtcbiAgICAgICAgY29uc29sZS5sb2coYFJlc2V0dGluZyBzZXNzaW9uIHZpYSBHRVQ6ICR7c3RhdGVLZXl9YCk7XG4gICAgICAgIGNvbnN0IHN0YXRlID0gYXdhaXQgcmVzZXRTdGF0ZShzdG9yZSwgc3RhdGVLZXkpO1xuICAgICAgICByZXR1cm4gbmV3IFJlc3BvbnNlKFxuICAgICAgICAgIEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgIC4uLnN0YXRlLFxuICAgICAgICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgICAgICAgLi4uc3RhdGUubWV0YWRhdGEsXG4gICAgICAgICAgICAgIHJlc2V0OiB0cnVlLFxuICAgICAgICAgICAgICBtZXNzYWdlOiBcIlNlc3Npb24gcmVzZXQgc3VjY2Vzc2Z1bGx5XCIsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIH0pLFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHN0YXR1czogMjAwLFxuICAgICAgICAgICAgaGVhZGVycyxcbiAgICAgICAgICB9XG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHN0YXRlID0gYXdhaXQgZ2V0U3RhdGUoc3RvcmUsIHN0YXRlS2V5KTtcbiAgICAgIHJldHVybiBuZXcgUmVzcG9uc2UoSlNPTi5zdHJpbmdpZnkoc3RhdGUpLCB7XG4gICAgICAgIHN0YXR1czogMjAwLFxuICAgICAgICBoZWFkZXJzLFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gR0VUIC9zZXNzaW9ucyAtIExpc3QgYWxsIHNlc3Npb25zIChhZG1pbi9kZWJ1ZylcbiAgICBpZiAocmVxLm1ldGhvZCA9PT0gXCJHRVRcIiAmJiBwYXRoID09PSBcIi9zZXNzaW9uc1wiKSB7XG4gICAgICBjb25zdCBzZXNzaW9ucyA9IGF3YWl0IGxpc3RTZXNzaW9ucyhzdG9yZSk7XG4gICAgICByZXR1cm4gbmV3IFJlc3BvbnNlKFxuICAgICAgICBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgc2Vzc2lvbnMsXG4gICAgICAgICAgY3VycmVudFNlc3Npb246IHN0YXRlS2V5LFxuICAgICAgICB9KSxcbiAgICAgICAge1xuICAgICAgICAgIHN0YXR1czogMjAwLFxuICAgICAgICAgIGhlYWRlcnMsXG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gR0VUIC9oaXN0b3J5IC0gR2V0IHN0YXRlIGhpc3RvcnkgKGRlcHJlY2F0ZWQgYnV0IGtlcHQgZm9yIGNvbXBhdGliaWxpdHkpXG4gICAgaWYgKHJlcS5tZXRob2QgPT09IFwiR0VUXCIgJiYgcGF0aCA9PT0gXCIvaGlzdG9yeVwiKSB7XG4gICAgICBjb25zdCBzdGF0ZSA9IGF3YWl0IGdldFN0YXRlKHN0b3JlLCBzdGF0ZUtleSk7XG4gICAgICByZXR1cm4gbmV3IFJlc3BvbnNlKFxuICAgICAgICBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgaGlzdG9yeTogW10sIC8vIE5vIGxvbmdlciBzdG9yaW5nIGhpc3Rvcnkgd2l0aCBCbG9icyBhcHByb2FjaFxuICAgICAgICAgIGN1cnJlbnRTdGF0ZTogc3RhdGUsXG4gICAgICAgIH0pLFxuICAgICAgICB7XG4gICAgICAgICAgc3RhdHVzOiAyMDAsXG4gICAgICAgICAgaGVhZGVycyxcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBQT1NUIC91cGRhdGUgLSBVcGRhdGUgc3RhdGVcbiAgICBpZiAocmVxLm1ldGhvZCA9PT0gXCJQT1NUXCIgJiYgcGF0aCA9PT0gXCIvdXBkYXRlXCIpIHtcbiAgICAgIGNvbnN0IGJvZHkgPSBhd2FpdCByZXEuanNvbigpO1xuICAgICAgY29uc3QgeyB1cGRhdGVzLCBhZ2VudElkIH0gPSBib2R5O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB1cGRhdGVTdGF0ZShzdG9yZSwgc3RhdGVLZXksIHVwZGF0ZXMsIGFnZW50SWQpO1xuXG4gICAgICByZXR1cm4gbmV3IFJlc3BvbnNlKEpTT04uc3RyaW5naWZ5KHJlc3VsdCksIHtcbiAgICAgICAgc3RhdHVzOiByZXN1bHQuc3VjY2VzcyA/IDIwMCA6IDQwMCxcbiAgICAgICAgaGVhZGVycyxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIFBPU1QgL3Jlc2V0IC0gUmVzZXQgc3RhdGVcbiAgICBpZiAocmVxLm1ldGhvZCA9PT0gXCJQT1NUXCIgJiYgcGF0aCA9PT0gXCIvcmVzZXRcIikge1xuICAgICAgY29uc3Qgc3RhdGUgPSBhd2FpdCByZXNldFN0YXRlKHN0b3JlLCBzdGF0ZUtleSk7XG5cbiAgICAgIHJldHVybiBuZXcgUmVzcG9uc2UoXG4gICAgICAgIEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgIHN0YXRlLFxuICAgICAgICB9KSxcbiAgICAgICAge1xuICAgICAgICAgIHN0YXR1czogMjAwLFxuICAgICAgICAgIGhlYWRlcnMsXG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gREVMRVRFIC9zZXNzaW9uIC0gRGVsZXRlIGEgc3BlY2lmaWMgc2Vzc2lvblxuICAgIGlmIChyZXEubWV0aG9kID09PSBcIkRFTEVURVwiICYmIHBhdGggPT09IFwiL3Nlc3Npb25cIikge1xuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgc3RvcmUuZGVsZXRlKHN0YXRlS2V5KTtcbiAgICAgICAgcmV0dXJuIG5ldyBSZXNwb25zZShcbiAgICAgICAgICBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgICAgbWVzc2FnZTogYFNlc3Npb24gJHtzdGF0ZUtleX0gZGVsZXRlZGAsXG4gICAgICAgICAgfSksXG4gICAgICAgICAge1xuICAgICAgICAgICAgc3RhdHVzOiAyMDAsXG4gICAgICAgICAgICBoZWFkZXJzLFxuICAgICAgICAgIH1cbiAgICAgICAgKTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIHJldHVybiBuZXcgUmVzcG9uc2UoXG4gICAgICAgICAgSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgICBlcnJvcjogZXJyb3IubWVzc2FnZSxcbiAgICAgICAgICB9KSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBzdGF0dXM6IDUwMCxcbiAgICAgICAgICAgIGhlYWRlcnMsXG4gICAgICAgICAgfVxuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIE1ldGhvZCBub3QgYWxsb3dlZFxuICAgIHJldHVybiBuZXcgUmVzcG9uc2UoXG4gICAgICBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIGVycm9yOiBgTWV0aG9kICR7cmVxLm1ldGhvZH0gbm90IGFsbG93ZWQgZm9yIHBhdGggJHtwYXRofWAsXG4gICAgICB9KSxcbiAgICAgIHtcbiAgICAgICAgc3RhdHVzOiA0MDUsXG4gICAgICAgIGhlYWRlcnMsXG4gICAgICB9XG4gICAgKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiQ2FudmFzIHN0YXRlIGVycm9yOlwiLCBlcnJvcik7XG4gICAgcmV0dXJuIG5ldyBSZXNwb25zZShcbiAgICAgIEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgZXJyb3I6IFwiRmFpbGVkIHRvIHByb2Nlc3MgY2FudmFzIHN0YXRlIHJlcXVlc3RcIixcbiAgICAgICAgZGV0YWlsczogZXJyb3IubWVzc2FnZSxcbiAgICAgIH0pLFxuICAgICAge1xuICAgICAgICBzdGF0dXM6IDUwMCxcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgIC4uLmhlYWRlcnMsXG4gICAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICAgIH0sXG4gICAgICB9XG4gICAgKTtcbiAgfVxufTtcblxuZXhwb3J0IGRlZmF1bHQgaGFuZGxlcjtcbiJdLAogICJtYXBwaW5ncyI6ICI7Ozs7Ozs7Ozs7QUFNQSxTQUFTLGdCQUFnQjtBQUd6QixJQUFNLGdCQUFnQjtBQUFBLEVBQ3BCLFlBQVk7QUFBQSxJQUNWLHNCQUFzQjtBQUFBO0FBQUEsSUFDdEIsZ0JBQWdCO0FBQUE7QUFBQSxJQUNoQixnQkFBZ0I7QUFBQTtBQUFBLElBQ2hCLGNBQWM7QUFBQTtBQUFBLElBQ2QsY0FBYztBQUFBO0FBQUEsSUFDZCxNQUFNO0FBQUE7QUFBQSxJQUNOLFlBQVk7QUFBQTtBQUFBLElBQ1osVUFBVTtBQUFBO0FBQUEsSUFDVixpQkFBaUI7QUFBQTtBQUFBLEVBQ25CO0FBQUEsRUFDQSxvQkFBb0I7QUFBQTtBQUFBLEVBQ3BCLFVBQVU7QUFBQSxJQUNSLE9BQU8sQ0FBQztBQUFBLEVBQ1Y7QUFBQSxFQUNBLGlCQUFpQjtBQUFBLElBQ2YsUUFBUSxDQUFDO0FBQUEsRUFDWDtBQUFBLEVBQ0EsVUFBVTtBQUFBLElBQ1IsVUFBVSxDQUFDO0FBQUEsRUFDYjtBQUFBLEVBQ0EsVUFBVTtBQUFBLElBQ1IsY0FBYztBQUFBLElBQ2QsY0FBYztBQUFBO0FBQUEsSUFDZCxlQUFlO0FBQUEsSUFDZixrQkFBa0IsQ0FBQztBQUFBLElBQ25CLGNBQWM7QUFBQSxFQUNoQjtBQUFBLEVBQ0EsVUFBVTtBQUFBLElBQ1IsY0FBYSxvQkFBSSxLQUFLLEdBQUUsWUFBWTtBQUFBLElBQ3BDLFNBQVM7QUFBQSxFQUNYO0FBQ0Y7QUFLQSxTQUFTLGFBQWEsU0FBUztBQUc3QixRQUFNLGNBQWM7QUFBQSxJQUNsQixNQUFNO0FBQUEsRUFDUjtBQUdBLE1BQUksUUFBUSxNQUFNLElBQUk7QUFDcEIsZ0JBQVksU0FBUyxRQUFRLEtBQUs7QUFBQSxFQUNwQztBQUVBLE1BQUksUUFBUSxPQUFPO0FBQ2pCLGdCQUFZLFFBQVEsUUFBUTtBQUFBLEVBQzlCO0FBRUEsU0FBTyxTQUFTLFdBQVc7QUFDN0I7QUFLQSxTQUFTLFlBQVksS0FBSztBQUV4QixRQUFNLE1BQU0sSUFBSSxJQUFJLElBQUksR0FBRztBQUMzQixRQUFNLFlBQ0osSUFBSSxRQUFRLE1BQU0sY0FBYyxLQUNoQyxJQUFJLFFBQVEsY0FBYyxLQUMxQixJQUFJLGFBQWEsSUFBSSxTQUFTO0FBSWhDLE1BQUksQ0FBQyxVQUFXLFFBQU87QUFDdkIsU0FBTyxVQUFVLFdBQVcsVUFBVSxJQUFJLFlBQVksV0FBVyxTQUFTO0FBQzVFO0FBS0EsZUFBZSxVQUFVLE9BQU8sVUFBVTtBQUN4QyxNQUFJO0FBQ0YsVUFBTSxPQUFPLE1BQU0sTUFBTSxJQUFJLFFBQVE7QUFDckMsUUFBSSxNQUFNO0FBQ1IsYUFBTyxLQUFLLE1BQU0sSUFBSTtBQUFBLElBQ3hCO0FBRUEsV0FBTyxFQUFFLEdBQUcsY0FBYztBQUFBLEVBQzVCLFNBQVMsT0FBTztBQUNkLFlBQVEsTUFBTSxtQ0FBbUMsS0FBSztBQUV0RCxXQUFPLEVBQUUsR0FBRyxjQUFjO0FBQUEsRUFDNUI7QUFDRjtBQUtBLGVBQWUsVUFBVSxPQUFPLFVBQVUsT0FBTztBQUMvQyxNQUFJO0FBQ0YsVUFBTSxNQUFNLElBQUksVUFBVSxLQUFLLFVBQVUsS0FBSyxDQUFDO0FBQy9DLFdBQU87QUFBQSxFQUNULFNBQVMsT0FBTztBQUNkLFlBQVEsTUFBTSxnQ0FBZ0MsS0FBSztBQUNuRCxXQUFPO0FBQUEsRUFDVDtBQUNGO0FBS0EsZUFBZSxTQUFTLE9BQU8sVUFBVTtBQUN2QyxRQUFNLGNBQWMsTUFBTSxVQUFVLE9BQU8sUUFBUTtBQUNuRCxTQUFPO0FBQUEsSUFDTCxHQUFHO0FBQUEsSUFDSCxVQUFVO0FBQUEsTUFDUixHQUFHLFlBQVk7QUFBQSxNQUNmLFlBQVcsb0JBQUksS0FBSyxHQUFFLFlBQVk7QUFBQSxNQUNsQyxXQUFXO0FBQUEsSUFDYjtBQUFBLEVBQ0Y7QUFDRjtBQUtBLGVBQWUsWUFBWSxPQUFPLFVBQVUsU0FBUztBQUNuRCxNQUFJO0FBRUYsUUFBSSxDQUFDLFdBQVcsT0FBTyxZQUFZLFVBQVU7QUFDM0MsWUFBTSxJQUFJLE1BQU0sMEJBQTBCO0FBQUEsSUFDNUM7QUFHQSxRQUFJLGNBQWMsTUFBTSxVQUFVLE9BQU8sUUFBUTtBQUdqRCxrQkFBYyxVQUFVLGFBQWEsT0FBTztBQUc1QyxnQkFBWSxTQUFTLGVBQWMsb0JBQUksS0FBSyxHQUFFLFlBQVk7QUFDMUQsZ0JBQVksU0FBUyxXQUFXLFlBQVksU0FBUyxXQUFXLEtBQUs7QUFHckUsVUFBTSxVQUFVLE9BQU8sVUFBVSxXQUFXO0FBRTVDLFdBQU87QUFBQSxNQUNMLFNBQVM7QUFBQSxNQUNULE9BQU8sTUFBTSxTQUFTLE9BQU8sUUFBUTtBQUFBLElBQ3ZDO0FBQUEsRUFDRixTQUFTLE9BQU87QUFDZCxXQUFPO0FBQUEsTUFDTCxTQUFTO0FBQUEsTUFDVCxPQUFPLE1BQU07QUFBQSxJQUNmO0FBQUEsRUFDRjtBQUNGO0FBS0EsZUFBZSxXQUFXLE9BQU8sVUFBVTtBQUN6QyxRQUFNLGNBQWM7QUFBQSxJQUNsQixHQUFHO0FBQUEsSUFDSCxVQUFVO0FBQUEsTUFDUixjQUFhLG9CQUFJLEtBQUssR0FBRSxZQUFZO0FBQUEsTUFDcEMsU0FBUztBQUFBLE1BQ1QsV0FBVztBQUFBLElBQ2I7QUFBQSxFQUNGO0FBQ0EsUUFBTSxVQUFVLE9BQU8sVUFBVSxXQUFXO0FBQzVDLFNBQU8sU0FBUyxPQUFPLFFBQVE7QUFDakM7QUFLQSxlQUFlLGFBQWEsT0FBTztBQUNqQyxNQUFJO0FBQ0YsVUFBTSxFQUFFLE1BQU0sSUFBSSxNQUFNLE1BQU0sS0FBSztBQUNuQyxXQUFPLE1BQU0sSUFBSSxDQUFDLFVBQVU7QUFBQSxNQUMxQixLQUFLLEtBQUs7QUFBQTtBQUFBLE1BRVYsV0FBVyxLQUFLLElBQUksV0FBVyxVQUFVLElBQUksS0FBSyxJQUFJLFFBQVEsWUFBWSxFQUFFLElBQUksS0FBSztBQUFBLE1BQ3JGLFdBQVcsS0FBSyxRQUFRO0FBQUEsSUFDMUIsRUFBRTtBQUFBLEVBQ0osU0FBUyxPQUFPO0FBQ2QsWUFBUSxNQUFNLDJCQUEyQixLQUFLO0FBQzlDLFdBQU8sQ0FBQztBQUFBLEVBQ1Y7QUFDRjtBQUtBLFNBQVMsVUFBVSxRQUFRLFFBQVE7QUFDakMsUUFBTSxTQUFTLEVBQUUsR0FBRyxPQUFPO0FBRTNCLE1BQUksU0FBUyxNQUFNLEtBQUssU0FBUyxNQUFNLEdBQUc7QUFDeEMsV0FBTyxLQUFLLE1BQU0sRUFBRSxRQUFRLENBQUMsUUFBUTtBQUNuQyxVQUFJLFNBQVMsT0FBTyxHQUFHLENBQUMsR0FBRztBQUN6QixZQUFJLEVBQUUsT0FBTyxTQUFTO0FBQ3BCLGlCQUFPLEdBQUcsSUFBSSxPQUFPLEdBQUc7QUFBQSxRQUMxQixPQUFPO0FBQ0wsaUJBQU8sR0FBRyxJQUFJLFVBQVUsT0FBTyxHQUFHLEdBQUcsT0FBTyxHQUFHLENBQUM7QUFBQSxRQUNsRDtBQUFBLE1BQ0YsT0FBTztBQUNMLGVBQU8sR0FBRyxJQUFJLE9BQU8sR0FBRztBQUFBLE1BQzFCO0FBQUEsSUFDRixDQUFDO0FBQUEsRUFDSDtBQUVBLFNBQU87QUFDVDtBQUVBLFNBQVMsU0FBUyxNQUFNO0FBQ3RCLFNBQU8sUUFBUSxPQUFPLFNBQVMsWUFBWSxDQUFDLE1BQU0sUUFBUSxJQUFJO0FBQ2hFO0FBS0EsSUFBTSxVQUFVLE9BQU8sS0FBSyxZQUFZO0FBRXRDLFFBQU0sVUFBVTtBQUFBLElBQ2QsK0JBQStCO0FBQUEsSUFDL0IsZ0NBQWdDO0FBQUEsSUFDaEMsZ0NBQWdDO0FBQUEsSUFDaEMsZ0JBQWdCO0FBQUEsRUFDbEI7QUFHQSxNQUFJLElBQUksV0FBVyxXQUFXO0FBQzVCLFdBQU8sSUFBSSxTQUFTLE1BQU0sRUFBRSxRQUFRLENBQUM7QUFBQSxFQUN2QztBQUVBLE1BQUk7QUFFRixVQUFNLFFBQVEsYUFBYSxPQUFPO0FBR2xDLFVBQU0sV0FBVyxZQUFZLEdBQUc7QUFFaEMsVUFBTSxNQUFNLElBQUksSUFBSSxJQUFJLEdBQUc7QUFDM0IsVUFBTSxPQUFPLElBQUksU0FBUyxRQUFRLG9DQUFvQyxFQUFFO0FBR3hFLFlBQVEsSUFBSSx5QkFBeUIsSUFBSSxNQUFNLElBQUksSUFBSSxjQUFjLFFBQVEsRUFBRTtBQUcvRSxRQUFJLElBQUksV0FBVyxVQUFVLFNBQVMsTUFBTSxTQUFTLE1BQU07QUFFekQsWUFBTSxjQUFjLElBQUksYUFBYSxJQUFJLE9BQU8sTUFBTTtBQUV0RCxVQUFJLGFBQWE7QUFDZixnQkFBUSxJQUFJLDhCQUE4QixRQUFRLEVBQUU7QUFDcEQsY0FBTUEsU0FBUSxNQUFNLFdBQVcsT0FBTyxRQUFRO0FBQzlDLGVBQU8sSUFBSTtBQUFBLFVBQ1QsS0FBSyxVQUFVO0FBQUEsWUFDYixHQUFHQTtBQUFBLFlBQ0gsVUFBVTtBQUFBLGNBQ1IsR0FBR0EsT0FBTTtBQUFBLGNBQ1QsT0FBTztBQUFBLGNBQ1AsU0FBUztBQUFBLFlBQ1g7QUFBQSxVQUNGLENBQUM7QUFBQSxVQUNEO0FBQUEsWUFDRSxRQUFRO0FBQUEsWUFDUjtBQUFBLFVBQ0Y7QUFBQSxRQUNGO0FBQUEsTUFDRjtBQUVBLFlBQU0sUUFBUSxNQUFNLFNBQVMsT0FBTyxRQUFRO0FBQzVDLGFBQU8sSUFBSSxTQUFTLEtBQUssVUFBVSxLQUFLLEdBQUc7QUFBQSxRQUN6QyxRQUFRO0FBQUEsUUFDUjtBQUFBLE1BQ0YsQ0FBQztBQUFBLElBQ0g7QUFHQSxRQUFJLElBQUksV0FBVyxTQUFTLFNBQVMsYUFBYTtBQUNoRCxZQUFNLFdBQVcsTUFBTSxhQUFhLEtBQUs7QUFDekMsYUFBTyxJQUFJO0FBQUEsUUFDVCxLQUFLLFVBQVU7QUFBQSxVQUNiO0FBQUEsVUFDQSxnQkFBZ0I7QUFBQSxRQUNsQixDQUFDO0FBQUEsUUFDRDtBQUFBLFVBQ0UsUUFBUTtBQUFBLFVBQ1I7QUFBQSxRQUNGO0FBQUEsTUFDRjtBQUFBLElBQ0Y7QUFHQSxRQUFJLElBQUksV0FBVyxTQUFTLFNBQVMsWUFBWTtBQUMvQyxZQUFNLFFBQVEsTUFBTSxTQUFTLE9BQU8sUUFBUTtBQUM1QyxhQUFPLElBQUk7QUFBQSxRQUNULEtBQUssVUFBVTtBQUFBLFVBQ2IsU0FBUyxDQUFDO0FBQUE7QUFBQSxVQUNWLGNBQWM7QUFBQSxRQUNoQixDQUFDO0FBQUEsUUFDRDtBQUFBLFVBQ0UsUUFBUTtBQUFBLFVBQ1I7QUFBQSxRQUNGO0FBQUEsTUFDRjtBQUFBLElBQ0Y7QUFHQSxRQUFJLElBQUksV0FBVyxVQUFVLFNBQVMsV0FBVztBQUMvQyxZQUFNLE9BQU8sTUFBTSxJQUFJLEtBQUs7QUFDNUIsWUFBTSxFQUFFLFNBQVMsUUFBUSxJQUFJO0FBRTdCLFlBQU0sU0FBUyxNQUFNLFlBQVksT0FBTyxVQUFVLFNBQVMsT0FBTztBQUVsRSxhQUFPLElBQUksU0FBUyxLQUFLLFVBQVUsTUFBTSxHQUFHO0FBQUEsUUFDMUMsUUFBUSxPQUFPLFVBQVUsTUFBTTtBQUFBLFFBQy9CO0FBQUEsTUFDRixDQUFDO0FBQUEsSUFDSDtBQUdBLFFBQUksSUFBSSxXQUFXLFVBQVUsU0FBUyxVQUFVO0FBQzlDLFlBQU0sUUFBUSxNQUFNLFdBQVcsT0FBTyxRQUFRO0FBRTlDLGFBQU8sSUFBSTtBQUFBLFFBQ1QsS0FBSyxVQUFVO0FBQUEsVUFDYixTQUFTO0FBQUEsVUFDVDtBQUFBLFFBQ0YsQ0FBQztBQUFBLFFBQ0Q7QUFBQSxVQUNFLFFBQVE7QUFBQSxVQUNSO0FBQUEsUUFDRjtBQUFBLE1BQ0Y7QUFBQSxJQUNGO0FBR0EsUUFBSSxJQUFJLFdBQVcsWUFBWSxTQUFTLFlBQVk7QUFDbEQsVUFBSTtBQUNGLGNBQU0sTUFBTSxPQUFPLFFBQVE7QUFDM0IsZUFBTyxJQUFJO0FBQUEsVUFDVCxLQUFLLFVBQVU7QUFBQSxZQUNiLFNBQVM7QUFBQSxZQUNULFNBQVMsV0FBVyxRQUFRO0FBQUEsVUFDOUIsQ0FBQztBQUFBLFVBQ0Q7QUFBQSxZQUNFLFFBQVE7QUFBQSxZQUNSO0FBQUEsVUFDRjtBQUFBLFFBQ0Y7QUFBQSxNQUNGLFNBQVMsT0FBTztBQUNkLGVBQU8sSUFBSTtBQUFBLFVBQ1QsS0FBSyxVQUFVO0FBQUEsWUFDYixTQUFTO0FBQUEsWUFDVCxPQUFPLE1BQU07QUFBQSxVQUNmLENBQUM7QUFBQSxVQUNEO0FBQUEsWUFDRSxRQUFRO0FBQUEsWUFDUjtBQUFBLFVBQ0Y7QUFBQSxRQUNGO0FBQUEsTUFDRjtBQUFBLElBQ0Y7QUFHQSxXQUFPLElBQUk7QUFBQSxNQUNULEtBQUssVUFBVTtBQUFBLFFBQ2IsT0FBTyxVQUFVLElBQUksTUFBTSx5QkFBeUIsSUFBSTtBQUFBLE1BQzFELENBQUM7QUFBQSxNQUNEO0FBQUEsUUFDRSxRQUFRO0FBQUEsUUFDUjtBQUFBLE1BQ0Y7QUFBQSxJQUNGO0FBQUEsRUFDRixTQUFTLE9BQU87QUFDZCxZQUFRLE1BQU0sdUJBQXVCLEtBQUs7QUFDMUMsV0FBTyxJQUFJO0FBQUEsTUFDVCxLQUFLLFVBQVU7QUFBQSxRQUNiLE9BQU87QUFBQSxRQUNQLFNBQVMsTUFBTTtBQUFBLE1BQ2pCLENBQUM7QUFBQSxNQUNEO0FBQUEsUUFDRSxRQUFRO0FBQUEsUUFDUixTQUFTO0FBQUEsVUFDUCxHQUFHO0FBQUEsVUFDSCxnQkFBZ0I7QUFBQSxRQUNsQjtBQUFBLE1BQ0Y7QUFBQSxJQUNGO0FBQUEsRUFDRjtBQUNGO0FBRUEsSUFBTyx1QkFBUTsiLAogICJuYW1lcyI6IFsic3RhdGUiXQp9Cg==
